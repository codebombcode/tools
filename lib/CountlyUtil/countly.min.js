"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

(function (b) {
  function J() {
    if (y) {
      var a = { name: y, segment: oa };b.add_event({ key: "[CLY]_view", dur: n() - A, segmentation: a });y = null;
    }
  }function p(a) {
    if (!b.ignore_visitor) if (!b.app_key || !b.device_id) i("app_key or device_id is missing");else {
      a.app_key = b.app_key;a.device_id = b.device_id;a.sdk_name = pa;a.sdk_version = qa;b.country_code && (a.country_code = b.country_code);b.city && (a.city = b.city);null !== b.ip_address && (a.ip_address = b.ip_address);a.timestamp = K();var d = new Date();a.hour = d.getHours();a.dow = d.getDay();q.length > L && q.shift();q.push(a);h("cly_queue", q, !0);
    }
  }function B() {
    if (b.ignore_visitor) M = !1;else {
      M = !0;var a = 0;if ("undefined" !== typeof b.onload && 0 < b.onload.length) {
        for (a = 0; a < b.onload.length; a++) {
          if ("function" === typeof b.onload[a]) b.onload[a]();
        }b.onload = [];
      }if ("undefined" !== typeof b.q && 0 < b.q.length) {
        var d,
            e = b.q;b.q = [];for (a = 0; a < e.length; a++) {
          if (d = e[a], i("Processing queued call", d), "function" === typeof d) d();else if (d.constructor === Array && 0 < d.length) if ("undefined" !== typeof b[d[0]]) b[d[0]].apply(null, d.slice(1));else {
            var f = d[0].replace("userData.", "");"undefined" !== typeof b.userData[f] && b.userData[f].apply(null, d.slice(1));
          }
        }
      }w && N && z && (a = n(), a - u > O && (b.session_duration(a - u), u = a));0 < r.length && (r.length <= C ? (p({ events: JSON.stringify(r) }), r = []) : (a = r.splice(0, C), p({ events: JSON.stringify(a) })), h("cly_event", r));0 < q.length && P && n() > W && (P = !1, a = q.shift(), i("Processing request", a), X(a, function (a, d) {
        i("Request Finished", d, a);a && (q.unshift(d), W = n() + Q);h("cly_queue", q, !0);P = !0;
      }));setTimeout(B, R);
    }
  }function Y() {
    return h("cly_id") || Z();
  }function Z() {
    var a = new Date().getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (d) {
      var b = (a + 16 * Math.random()) % 16 | 0;a = Math.floor(a / 16);return ("x" == d ? b : b & 3 | 8).toString(16);
    });
  }function S() {
    var a = {};a._app_version = b.app_version;a._ua = navigator.userAgent;if (screen.width) {
      var d = screen.width ? parseInt(screen.width) : 0,
          e = screen.height ? parseInt(screen.height) : 0;if (0 !== d && 0 !== e) {
        if (navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform) && window.devicePixelRatio) d = Math.round(d * window.devicePixelRatio), e = Math.round(e * window.devicePixelRatio);else if (90 === Math.abs(window.orientation)) var f = d,
            d = e,
            e = f;a._resolution = "" + d + "x" + e;
      }
    }window.devicePixelRatio && (a._density = window.devicePixelRatio);d = navigator.language || navigator.browserLanguage || navigator.systemLanguage || navigator.userLanguage;"undefined" !== typeof d && (a._locale = d);if ("undefined" !== typeof document.referrer && document.referrer.length && (d = $.exec(document.referrer)) && d[11] && d[11] != window.location.hostname) {
      d = !1;if (x && x.length) for (e = 0; e < x.length; e++) {
        try {
          if (RegExp(x[e]).test(document.referrer)) {
            i("Ignored:", document.referrer);d = !0;break;
          }
        } catch (g) {}
      }d || (a._store = document.referrer);
    }i("Got metrics", a);return a;
  }function i() {
    b.debug && "undefined" !== typeof console && (arguments[1] && "object" == _typeof(arguments[1]) && (arguments[1] = JSON.stringify(arguments[1])), console.log(Array.prototype.slice.call(arguments).join("\n")));
  }function n() {
    return Math.floor(new Date().getTime() / 1E3);
  }function K() {
    var a = new Date().getTime();D >= a ? D++ : D = a;return D;
  }function E(a, d, b) {
    if (a) {
      var b = b || aa,
          f = "";"object" === (typeof a === "undefined" ? "undefined" : _typeof(a)) ? "undefined" !== typeof a.stack ? f = a.stack : ("undefined" !== typeof a.name && (f += a.name + ":"), "undefined" !== typeof a.message && (f += a.message + "\n"), "undefined" !== typeof a.fileName && (f += "in " + a.fileName + "\n"), "undefined" !== typeof a.lineNumber && (f += "on " + a.lineNumber), "undefined" !== typeof a.columnNumber && (f += ":" + a.columnNumber)) : f = a + "";d = d ? !0 : !1;a = S();f = { _resolution: a._resolution, _error: f, _app_version: a._app_version, _run: n() - ba, _not_os_specific: !0 };if (a = navigator.battery || navigator.webkitBattery || navigator.mozBattery || navigator.msBattery) f._bat = Math.floor(100 * a.level);"undefined" !== typeof navigator.onLine && (f._online = navigator.onLine ? !0 : !1);f._background = document.hasFocus() ? !1 : !0;0 < F.length && (f._logs = F.join("\n"));F = [];f._nonfatal = d;f._view = (window.location.pathname || "") + (window.location.search || "") + (window.location.hash || "");"undefined" !== typeof b && (f._custom = b);try {
        var g = document.createElement("canvas").getContext("experimental-webgl");f._opengl = g.getParameter(g.VERSION);
      } catch (c) {}p({ crash: JSON.stringify(f) });
    }
  }
  function X(a, d) {
    try {
      i("Sending XML HTTP request");var e = window.XMLHttpRequest ? new window.XMLHttpRequest() : window.ActiveXObject ? new ActiveXObject("Microsoft.XMLHTTP") : null,
          f = ca(a),
          g = "GET";2E3 <= f.length ? g = "POST" : b.force_post && (g = "POST");"GET" === g ? e.open("GET", b.url + da + "?" + f, !0) : (e.open("POST", b.url + da, !0), e.setRequestHeader("Content-type", "application/x-www-form-urlencoded"));e.onreadystatechange = function () {
        4 === this.readyState && 200 <= this.status && 300 > this.status ? "function" === typeof d && d(!1, a) : 4 === this.readyState && (i("Failed Server XML HTTP request", this.status), "function" === typeof d && d(!0, a));
      };"GET" == g ? e.send() : e.send(f);
    } catch (c) {
      i("Failed XML HTTP request", c), "function" === typeof d && d(!0, a);
    }
  }function ca(a) {
    var d = [],
        b;for (b in a) {
      d.push(b + "=" + encodeURIComponent(a[b]));
    }return d.join("&");
  }function ea(a) {
    return "/" == a.substr(a.length - 1) ? a.substr(0, a.length - 1) : a;
  }function T(a, d) {
    for (var b = {}, f, g = 0; g < d.length; g++) {
      f = d[g], "undefined" !== typeof a[f] && (b[f] = a[f]);
    }return b;
  }function U(a) {
    "undefined" == typeof a.pageY && "number" == typeof a.clientX && document.documentElement && (a.pageX = a.clientX + document.body.scrollLeft + document.documentElement.scrollLeft, a.pageY = a.clientY + document.body.scrollTop + document.documentElement.scrollTop);return a;
  }function fa() {
    var a = document;return Math.max(Math.max(a.body.scrollHeight, a.documentElement.scrollHeight), Math.max(a.body.offsetHeight, a.documentElement.offsetHeight), Math.max(a.body.clientHeight, a.documentElement.clientHeight));
  }function ga() {
    var a = document;return Math.max(Math.max(a.body.scrollWidth, a.documentElement.scrollWidth), Math.max(a.body.offsetWidth, a.documentElement.offsetWidth), Math.max(a.body.clientWidth, a.documentElement.clientWidth));
  }function ha(a) {
    h("cly_token", a);
  }function ia(a, d) {
    var b = document.createElement("script"),
        f;b.setAttribute("type", "text/javascript");b.setAttribute("src", a);d && (b.onreadystatechange = b.onload = function () {
      f || d();f = !0;
    });document.getElementsByTagName("head")[0].appendChild(b);
  }function ja() {
    var a = document.getElementById("cly-loader");if (!a) {
      i("setting up loader");
      var a = document.head || document.getElementsByTagName("head")[0],
          b = document.createElement("style");b.type = "text/css";b.styleSheet ? b.styleSheet.cssText = "#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}" : b.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
      a.appendChild(b);a = document.createElement("div");a.setAttribute("id", "cly-loader");document.body.appendChild(a);
    }a.style.display = "block";
  }function ka() {
    var a = document.getElementById("cly-loader");a && (a.style.display = "none");
  }var qa = "17.04",
      pa = "javascript_native_web",
      la = !1,
      w = !1,
      da = "/i",
      R = 500,
      L = 1E3,
      q = [],
      r = [],
      F = [],
      v = {},
      x = [],
      aa = null,
      N = !0,
      u,
      ma = 0,
      y = null,
      A = 0,
      V = 0,
      W = 0,
      Q = 60,
      G = 20,
      H = 0,
      O = 60,
      C = 10,
      D = 0,
      P = !0,
      oa,
      M = !1,
      $ = /^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
      na = /(CountlySiteBot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,
      z = !0,
      ba;b.init = function (a) {
    if (!la && (ba = n(), la = !0, q = h("cly_queue") || [], v = {}, r = h("cly_event") || [], a = a || {}, R = a.interval || b.interval || R, L = a.queue_size || b.queue_size || L, Q = a.fail_timeout || b.fail_timeout || Q, G = a.inactivity_time || b.inactivity_time || G, O = a.session_update || b.session_update || O, C = a.max_events || b.max_events || C, b.ignore_prefetch = a.ignore_prefetch || b.ignore_prefetch || !0, b.debug = a.debug || b.debug || !1, b.app_key = a.app_key || b.app_key || null, b.device_id = a.device_id || b.device_id || Y(), b.url = ea(a.url || b.url || ""), b.app_version = a.app_version || b.app_version || "0.0", b.country_code = a.country_code || b.country_code || null, b.city = a.city || b.city || null, b.ip_address = a.ip_address || b.ip_address || null, b.ignore_bots = a.ignore_bots || b.ignore_bots || !0, b.force_post = a.force_post || b.force_post || !1, b.q = b.q || [], b.onload = b.onload || [], b.ignore_visitor = a.ignore_visitor || b.ignore_visitor || !1, a.ignore_referrers && a.ignore_referrers.constructor === Array ? x = a.ignore_referrers : b.ignore_referrers && b.ignore_referrers.constructor === Array && (x = b.ignore_referrers), "" === b.url && (i("Please provide server URL"), b.ignore_visitor = !0), h("cly_ignore") && (b.ignore_visitor = !0), b.ignore_prefetch && "undefined" !== typeof document.visibilityState && "prerender" === document.visibilityState && (b.ignore_visitor = !0), b.ignore_bots && na.test(navigator.userAgent) && (b.ignore_visitor = !0), window.name && 0 === window.name.indexOf("cly:") ? b.passed_data = JSON.parse(window.name.replace("cly:", "")) : location.hash && 0 === location.hash.indexOf("#cly:") && (b.passed_data = JSON.parse(location.hash.replace("#cly:", ""))), b.passed_data && b.passed_data.token && b.passed_data.purpose && (b.passed_data.token != h("cly_old_token") && (ha(b.passed_data.token), h("cly_old_token", b.passed_data.token)), "heatmap" === b.passed_data.purpose && (b.ignore_visitor = !0, ja(), ia(b.url + "/views/heatmap.js", ka))), !b.ignore_visitor && (i("Countly initialized"), b.onload.constructor !== Array && (b.onload = []), b.q.constructor !== Array && (b.q = []), B(), h("cly_id", b.device_id), location.search))) for (var a = location.search.substring(1).split("&"), d = 0; d < a.length; d++) {
      var e = a[d].split("=");"cly_id" == e[0] ? h("cly_cmp_id", e[1]) : "cly_uid" == e[0] && h("cly_cmp_uid", e[1]);
    }
  };b.begin_session = function (a) {
    w || (i("Session started"), u = n(), w = !0, N = a ? !1 : !0, a = { begin_session: 1 }, a.metrics = JSON.stringify(S()), p(a));
  };b.session_duration = function (a) {
    w && (i("Session extended", a), p({ session_duration: a }));
  };b.end_session = function (a) {
    w && (a = a || n() - u, i("Ending session"), J(), w = !1, p({ end_session: 1, session_duration: a }));
  };b.change_id = function (a, d) {
    if (b.device_id != a) {
      d || (b.end_session(), v = {});var e = b.device_id;b.device_id = a;h("cly_id", b.device_id);i("Changing id");d ? p({ old_device_id: e }) : b.begin_session(!N);
    }
  };b.add_event = function (a) {
    if (a.key) {
      a.count || (a.count = 1);var b = T(a, ["key", "count", "sum", "dur", "segmentation"]);b.timestamp = K();var e = new Date();b.hour = e.getHours();b.dow = e.getDay();r.push(b);h("cly_event", r);i("Adding event: ", a);
    } else i("Event must have key property");
  };b.start_event = function (a) {
    v[a] ? i("Timed event with key " + a + " already started") : v[a] = n();
  };b.end_event = function (a) {
    "string" == typeof a && (a = { key: a });a.key ? v[a.key] ? (a.dur = n() - v[a.key], b.add_event(a), delete v[a.key]) : i("Timed event with key " + a.key + " was not started") : i("Event must have key property");
  };b.user_details = function (a) {
    i("Adding userdetails: ", a);p({ user_details: JSON.stringify(T(a, "name username email organization phone picture gender byear custom".split(" "))) });
  };b.report_conversion = function (a, b) {
    a = a || h("cly_cmp_id") || "cly_organic";b = b || h("cly_cmp_uid");a && b ? p({ campaign_id: a, campaign_user: b }) : a ? p({ campaign_id: a }) : i("No campaign data found");
  };var s = {},
      t = function t(a, b, e) {
    s[a] || (s[a] = {});"$push" == e || "$pull" == e || "$addToSet" == e ? (s[a][e] || (s[a][e] = []), s[a][e].push(b)) : s[a][e] = b;
  };b.userData = { set: function set(a, b) {
      s[a] = b;
    }, set_once: function set_once(a) {
      t(a, 1, "$setOnce");
    }, increment: function increment(a) {
      t(a, 1, "$inc");
    }, increment_by: function increment_by(a, b) {
      t(a, b, "$inc");
    }, multiply: function multiply(a, b) {
      t(a, b, "$mul");
    }, max: function max(a, b) {
      t(a, b, "$max");
    }, min: function min(a, b) {
      t(a, b, "$min");
    }, push: function push(a, b) {
      t(a, b, "$push");
    }, push_unique: function push_unique(a, b) {
      t(a, b, "$addToSet");
    }, pull: function pull(a, b) {
      t(a, b, "$pull");
    },
    save: function save() {
      p({ user_details: JSON.stringify({ custom: s }) });s = {};
    } };b.track_errors = function (a) {
    aa = a;window.onerror = function (a, b, f, g, c) {
      if ("undefined" !== typeof c) E(c, !1);else {
        var g = g || window.event && window.event.errorCharacter,
            j = "";"undefined" !== typeof a && (j += a + "\n");"undefined" !== typeof b && (j += "at " + b);"undefined" !== typeof f && (j += ":" + f);"undefined" !== typeof g && (j += ":" + g);j += "\n";try {
          for (var i = [], k = arguments.callee.caller; k;) {
            i.push(k.name), k = k.caller;
          }j += i.join("\n");
        } catch (h) {}E(j, !1);
      }
    };
  };b.log_error = function (a, b) {
    E(a, !0, b);
  };b.add_log = function (a) {
    F.push(a);
  };b.stop_time = function () {
    z && (z = !1, ma = n() - u, V = n() - A);
  };b.start_time = function () {
    z || (z = !0, u = n() - ma, A = n() - V, V = 0);
  };b.track_sessions = function () {
    function a() {
      document[e] ? b.stop_time() : b.start_time();
    }function d() {
      H >= G && b.start_time();H = 0;
    }b.begin_session();b.start_time();m(window, "beforeunload", function () {
      b.end_session();
    });m(window, "unload", function () {
      b.end_session();
    });var e = "hidden";e in document ? document.addEventListener("visibilitychange", a) : (e = "mozHidden") in document ? document.addEventListener("mozvisibilitychange", a) : (e = "webkitHidden") in document ? document.addEventListener("webkitvisibilitychange", a) : (e = "msHidden") in document ? document.addEventListener("msvisibilitychange", a) : "onfocusin" in document ? (m(window, "focusin", function () {
      b.start_time();
    }), m(window, "focusout", function () {
      b.stop_time();
    })) : (m(window, "focus", function () {
      b.start_time();
    }), m(window, "blur", function () {
      b.stop_time();
    }), m(window, "pageshow", function () {
      b.start_time();
    }), m(window, "pagehide", function () {
      b.stop_time();
    }));
    m(window, "mousemove", d);m(window, "click", d);m(window, "keydown", d);m(window, "scroll", d);setInterval(function () {
      H++;H >= G && b.stop_time();
    }, 6E4);
  };b.track_pageview = function (a, d) {
    J();a && a.constructor === Array && (d = a, a = null);a = a || window.location.pathname;if (d && d.length) for (var e = 0; e < d.length; e++) {
      try {
        if (RegExp(d[e]).test(a)) {
          i("Ignored:", a);return;
        }
      } catch (f) {}
    }y = a;A = n();e = { name: a, visit: 1, domain: window.location.hostname };if ("undefined" !== typeof document.referrer && document.referrer.length) {
      var g = $.exec(document.referrer);
      g && g[11] && g[11] != window.location.hostname && (e.start = 1);
    }b.add_event({ key: "[CLY]_view", segmentation: e });
  };b.track_view = function (a, d) {
    b.track_pageview(a, d);
  };b.track_clicks = function (a) {
    var a = a || document,
        d = !0;m(a, "click", function (a) {
      if (d) {
        d = !1;U(a);if ("undefined" !== typeof a.pageX && "undefined" !== typeof a.pageY) {
          var f = fa(),
              g = ga();b.add_event({ key: "[CLY]_action", segmentation: { type: "click", x: a.pageX, y: a.pageY, width: g, height: f, domain: window.location.hostname, view: window.location.pathname } });
        }setTimeout(function () {
          d = !0;
        }, 1E3);
      }
    });
  };b.track_links = function (a) {
    a = a || document;m(a, "click", function (a) {
      var e = I(a).closest("a");e && (U(a), b.add_event({ key: "linkClick", segmentation: { href: e.href, text: e.innerText, id: e.id, x: a.pageX, y: a.pageY, view: window.location.pathname } }), "undefined" !== typeof e.href && "_blank" !== e.target && !a.metaKey && !a.altKey && !a.ctrlKey && !a.shiftKey && 0 !== e.href.replace(window.location.href.split("#")[0], "").indexOf("#") && b.end_session());
    });
  };b.track_forms = function (a) {
    function d(a) {
      return a.name || a.id || a.type || a.nodeName;
    }a = a || document;m(a, "submit", function (a) {
      var a = I(a),
          f = { id: a.id, name: a.name, action: a.action, method: a.method, view: window.location.pathname },
          g;if ("undefined" !== typeof a.elements) for (var c = 0; c < a.elements.length; c++) {
        if ((g = a.elements[c]) && "password" != g.type) if ("undefined" === typeof f["input:" + d(g)] && (f["input:" + d(g)] = []), "select" == g.nodeName.toLowerCase()) {
          if ("undefined" !== typeof g.multiple) {
            var j = [];if ("undefined" !== typeof g.options) for (var i = 0; i < g.options.length; i++) {
              g.options[i].selected && j.push(g.options[i].value);
            }f["input:" + d(g)].push(j.join(", "));
          } else f["input:" + d(g)].push(g.options[g.selectedIndex].value);
        } else "input" == g.nodeName.toLowerCase() ? "undefined" !== typeof g.type ? "checkbox" == g.type.toLowerCase() || "radio" == g.type.toLowerCase() ? g.checked && f["input:" + d(g)].push(g.value) : f["input:" + d(g)].push(g.value) : f["input:" + d(g)].push(g.value) : "textarea" == g.nodeName.toLowerCase() ? f["input:" + d(g)].push(g.value) : "undefined" !== typeof g.value && f["input:" + d(g)].push(g.value);
      }for (var k in f) {
        "undefined" != typeof f[k].join && (f[k] = f[k].join(", "));
      }b.add_event({ key: "formSubmit", segmentation: f });b.end_session();
    });
  };b.collect_from_forms = function (a, d) {
    a = a || document;m(a, "submit", function (e) {
      var e = I(e),
          f = {},
          g = !1,
          c;if ("undefined" !== typeof e.elements) {
        var j = {},
            h = a.getElementsByTagName("LABEL"),
            k;for (k = 0; k < h.length; k++) {
          h[k].htmlFor && "" !== h[k].htmlFor && (j[h[k].htmlFor] = h[k].innerText || h[k].textContent || h[k].innerHTML);
        }for (k = 0; k < e.elements.length; k++) {
          if ((c = e.elements[k]) && "password" != c.type && -1 == c.className.indexOf("cly_user_ignore")) {
            var l = "";if ("select" == c.nodeName.toLowerCase()) {
              if ("undefined" !== typeof c.multiple) {
                l = [];if ("undefined" !== typeof c.options) for (h = 0; h < c.options.length; h++) {
                  c.options[h].selected && l.push(c.options[h].value);
                }l = l.join(", ");
              } else l = c.options[c.selectedIndex].value;
            } else "input" == c.nodeName.toLowerCase() ? "undefined" !== typeof c.type ? "checkbox" == c.type.toLowerCase() || "radio" == c.type.toLowerCase() ? c.checked && (l = c.value) : l = c.value : l = c.value : "textarea" == c.nodeName.toLowerCase() ? l = c.value : "undefined" !== typeof c.value && (l = c.value);if (c.className && -1 != c.className.indexOf("cly_user_")) {
              c = c.className.split(" ");for (h = 0; h < c.length; h++) {
                if (0 === c[h].indexOf("cly_user_")) {
                  f[c[h].replace("cly_user_", "")] = l;g = !0;break;
                }
              }
            } else if (c.type && "email" == c.type.toLowerCase() || c.name && -1 != c.name.toLowerCase().indexOf("email") || c.id && -1 != c.id.toLowerCase().indexOf("email") || c.id && j[c.id] && -1 != j[c.id].toLowerCase().indexOf("email") || /[^@\s]+@[^@\s]+\.[^@\s]+/.test(l)) f.email || (f.email = l), g = !0;else if (c.name && -1 != c.name.toLowerCase().indexOf("username") || c.id && -1 != c.id.toLowerCase().indexOf("username") || c.id && j[c.id] && -1 != j[c.id].toLowerCase().indexOf("username")) f.username || (f.username = l), g = !0;else if (c.name && (-1 != c.name.toLowerCase().indexOf("tel") || -1 != c.name.toLowerCase().indexOf("phone") || -1 != c.name.toLowerCase().indexOf("number")) || c.id && (-1 != c.id.toLowerCase().indexOf("tel") || -1 != c.id.toLowerCase().indexOf("phone") || -1 != c.id.toLowerCase().indexOf("number")) || c.id && j[c.id] && (-1 != j[c.id].toLowerCase().indexOf("tel") || -1 != j[c.id].toLowerCase().indexOf("phone") || -1 != j[c.id].toLowerCase().indexOf("number"))) f.phone || (f.phone = l), g = !0;else if (c.name && (-1 != c.name.toLowerCase().indexOf("org") || -1 != c.name.toLowerCase().indexOf("company")) || c.id && (-1 != c.id.toLowerCase().indexOf("org") || -1 != c.id.toLowerCase().indexOf("company")) || c.id && j[c.id] && (-1 != j[c.id].toLowerCase().indexOf("org") || -1 != j[c.id].toLowerCase().indexOf("company"))) f.organization || (f.organization = l), g = !0;else if (c.name && -1 != c.name.toLowerCase().indexOf("name") || c.id && -1 != c.id.toLowerCase().indexOf("name") || c.id && j[c.id] && -1 != j[c.id].toLowerCase().indexOf("name")) f.name || (f.name = ""), f.name += l + " ", g = !0;
          }
        }
      }g && (i("Gathered user data", f), d ? b.user_details({ custom: f }) : b.user_details(f));b.end_session();
    });
  };b.collect_from_facebook = function (a) {
    FB && FB.api && FB.api("/me", function (d) {
      var e = {};d.name && (e.name = d.name);d.email && (e.email = d.email);"male" == d.gender ? e.gender = "M" : "female" == d.gender && (e.gender = "F");if (d.birthday) {
        var f = d.birthday.split("/").pop();f && 4 == f.length && (e.byear = f);
      }d.work && d.work[0] && d.work[0].employer && d.work[0].employer.name && (e.organization = d.work[0].employer.name);if (a) {
        e.custom = {};for (var g in a) {
          for (var f = a[g].split("."), c = d, h = 0; h < f.length && !(c = c[f[h]], "undefined" === typeof c); h++) {}"undefined" !== typeof c && (e.custom[g] = c);
        }
      }b.user_details(e);
    });
  };b.opt_out = function () {
    b.ignore_visitor = !0;h("cly_ignore", !0);
  };b.opt_in = function () {
    h("cly_ignore", !1);b.ignore_visitor = !1;b.ignore_prefetch && "undefined" !== typeof document.visibilityState && "prerender" === document.visibilityState && (b.ignore_visitor = !0);b.ignore_bots && na.test(navigator.userAgent) && (b.ignore_visitor = !0);!b.ignore_visitor && !M && B();
  };Element.prototype.closest || (Element.prototype.closest = function (a) {
    for (var b = this, a = a.toUpperCase(); b;) {
      if (b.nodeName.toUpperCase() == a) return b;b = b.parentElement;
    }
  });var m = function m(a, b, e) {
    "undefined" !== typeof a.addEventListener ? a.addEventListener(b, e, !1) : a.attachEvent("on" + b, e);
  },
      I = function I(a) {
    return a ? "undefined" !== typeof a.target ? a.target : a.srcElement : window.event.srcElement;
  },
      h = function h(a, b, e) {
    function f(a, b, c) {
      var d = new Date();
      d.setTime(d.getTime() + 864E5 * c);c = "; expires=" + d.toGMTString();document.cookie = a + "=" + b + c + "; path=/";
    }var e = e || !1,
        g = !1,
        c,
        g = !0;try {
      "undefined" !== typeof localStorage && localStorage.setItem("testLocal", !0);
    } catch (h) {
      g = !1;
    }"undefined" !== typeof b && null !== b && ("object" === (typeof b === "undefined" ? "undefined" : _typeof(b)) && (b = JSON.stringify(b)), g ? localStorage.setItem(a, b) : e || f(a, b, 30));if ("undefined" === typeof b) {
      if (g) c = localStorage.getItem(a);else if (!e) a: {
        a += "=";b = document.cookie.split(";");e = 0;for (g = b.length; e < g; e++) {
          for (c = b[e]; " " === c.charAt(0);) {
            c = c.substring(1, c.length);
          }if (0 === c.indexOf(a)) {
            c = c.substring(a.length, c.length);break a;
          }
        }c = null;
      }try {
        c = JSON.parse(c);
      } catch (i) {}return c;
    }null === b && (g ? localStorage.removeItem(a) : e || f(a, "", -1));
  };b._internals = { store: h, getDocWidth: ga, getDocHeight: fa, get_page_coord: U, get_event_target: I, add_event: m, getProperties: T, stripTrailingSlash: ea, prepareParams: ca, sendXmlHttpRequest: X, recordError: E, getMsTimestamp: K, getTimestamp: n, log: i, getMetrics: S, generateUUID: Z, getId: Y, heartBeat: B, toRequestQueue: p, reportViewDuration: J,
    loadJS: ia, getLastView: function getLastView() {
      return y;
    }, setToken: ha, getToken: function getToken() {
      var a = h("cly_token");h("cly_token", null);return a;
    }, showLoader: ja, hideLoader: ka };
})(window.Countly = window.Countly || {});